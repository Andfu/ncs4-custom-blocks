!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.React},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.wp.data},function(e,t){function r(){return e.exports=r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,r.apply(this,arguments)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=window.wp.blockEditor},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function r(){return e.exports=r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,r.apply(this,arguments)}e.exports=r,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=window.lodash},function(e,t){e.exports=window.wp.blocks},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"getIds",(function(){return T})),r.d(n,"requestId",(function(){return I})),r.d(n,"getNextId",(function(){return P}));var a={};r.r(a),r.d(a,"createId",(function(){return D})),r.d(a,"deleteId",(function(){return Y}));var i={};r.r(i),r.d(i,"getRecipients",(function(){return ae})),r.d(i,"getState",(function(){return ie})),r.d(i,"getUsedIds",(function(){return se})),r.d(i,"getUseOrgs",(function(){return le})),r.d(i,"getCurrentYear",(function(){return oe})),r.d(i,"getOrganizations",(function(){return ce})),r.d(i,"hasId",(function(){return ue})),r.d(i,"createRecipientData",(function(){return pe})),r.d(i,"getNextId",(function(){return de}));var s={};r.r(s),r.d(s,"createRecipient",(function(){return be})),r.d(s,"deleteRecipient",(function(){return ge})),r.d(s,"editRecipient",(function(){return me})),r.d(s,"setRecipients",(function(){return fe})),r.d(s,"setUseOrgs",(function(){return Oe})),r.d(s,"setCurrentYear",(function(){return ye})),r.d(s,"setCurrentYearIf",(function(){return Ee})),r.d(s,"recalculateCurrentYear",(function(){return ve})),r.d(s,"addOrganization",(function(){return je})),r.d(s,"sortRecipients",(function(){return Ce})),r.d(s,"updateCurrentYear",(function(){return xe}));var l=r(4),o=r.n(l),c=r(0),u=r(9),p=r(5),d=r(1),h=r.n(d),b=r(2),g=r(3);function m(e,t){return e&&t?"has-"+e+"-"+t:null}class f extends h.a.Component{render(){let e=this.props.label,t=(this.props.allowGradients,this.props.value),r=this.props.onChange,n=Object(g.select)("core/block-editor").getSettings();return Object(c.createElement)(c.Fragment,null,Object(c.createElement)("p",null,e),Object(c.createElement)(b.ColorPalette,{colors:n.colors,disableCustomColors:n.disableCustomColors,clearable:!n.disableCustomColors,value:t,onChange:e=>{let t=n.colors.filter(t=>t.color===e)[0];r({color:e,slug:t?t.slug:null})}}))}}function O(e){let t=Object(g.select)("core/block-editor").getSettings().colors;return function(e,t){let r=t.filter(t=>t.slug===e)[0];return r?r.color:null}(e.slug,t)}function y(e,t){let r,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=E(e);if(i.length===t)return i.toString();if(i.length<=t){let e=a?t-3-i.length:t-i.length;r=i.toString(),r+=n?" "+"&nbsp;".repeat(e-1):" ".repeat(e)}else i=i.slice(0,a?t-3:t),r=i.toString(),r+=a?"...":"";return r}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r={br:30,hr:30},n=(e,t)=>{e.text.forEach((r,a)=>"object"==typeof r?r.tag&&!r.hasEndTag?t(r,e,a):n(r,t):t(r,e,a))},a={slice(e,t){e<0&&slice(this.length+e),t<0&&slice(this.length+t),t=null==t?this.length:t;let r=Object.assign(Object.create(a),this);r.text=[];let i=0;return n(this,(n,s)=>{if("object"==typeof n&&n.tag&&!n.hasEndTag)i<e||i+n.length>t?i+=n.length:(i+=n.length,r.text.push(n),r.length+=n.length);else{let l=Object.assign(Object.create(a),s),o="",c=0;if(0===n.length)return;if(i<e)if(i+n.length>=e){let r=e-i;i+=r,c=Math.min(n.length,t-e),o=n.slice(r,r+c)}else i+=n.length;else i<t&&(c=Math.min(n.length,t-i),o=n.slice(0,c),i+=c);""!==o&&(l.text=[o],l.length=c,r.text.push(l),r.length=Math.max(0,i-e))}}),r},toString(){let e="";return n(this,(t,r,n)=>{"object"!=typeof t||!t.tag||t.hasEndTag?(r.tag&&0===n&&(e+="<"+r.tag+">"),e+=t,r.tag&&r.hasEndTag&&n===r.text.length-1&&(e+="</"+r.tag+">")):e+="<"+t.tag+">"}),e}};let i=Object.create(a);i=Object.assign(i,{length:0,tag:t,hasEndTag:!1,text:[]});let s=[],l=e,o=l.search("<"),c=l.search(">");for(;-1!==o&&-1!==c;){let e=l.slice(0,o);""!==e&&s.push(e),s.push(l.slice(o,c+1)),l=l.slice(c+1),o=l.search("<"),c=l.search(">")}""!==l&&s.push(l);const u=(e,t,n,i)=>{if(e.hasEndTag||n>=i.length)return e;if(/^<\/.*>$/.test(t)){if(o=t.search("<")+1,c=t.search(">"),t.slice(o+1,c)===e.tag)return e.hasEndTag=!0,e}else if(/^<.*>$/.test(t)){o=t.search("<"),c=t.search(">");let s=Object.create(a);s=Object.assign(s,{length:0,tag:t.slice(o+1,c),hasEndTag:!1,text:[]}),r[s.tag]?s.length=r[s.tag]:(s=((e,t)=>v(e,u,t))(i.slice(n+1),s),n+=1+s.text.length),e.text.push(s),e.length+=s.length}else e.text.push(t),e.length+=t.length;return e.tag&&n+1===i.length&&!e.hasEndTag&&console.error("EOL reached: Expected closing tag for <"+e.tag+">"),((e,t)=>()=>u(Object.assign(Object.create(a),e),i[t+1],t+1,i))(e,n)};return i=v(s,u,i),i}function v(e,t,r){let n=t(r,e[0],0,e);for(;"function"==typeof n;)n=n();return n}var j=r(6),C=r.n(j),x=r(7),_=r.n(x);class w extends h.a.Component{getChoices(e){let t=[];return e.forEach((e,r)=>{t[r]={attribute:e.attribute,value:e.value||e.default}}),t}getChoice(e,t){for(let r of t)if(r.attribute===e)return r}render(){let e=this.props.maxRadioOptions||5,t=this.props.options,r=this.props.onChange,n=this.getChoices(t),a=[...Array(t.length).keys()].map(a=>Object(c.createElement)(S,{key:a,maxRadioOptions:e,label:t[a].label,help:t[a].help,choices:t[a].choices,multiple:t[a].multiple,invertValue:t[a].invertValue,min:t[a].min,max:t[a].max,step:t[a].step,markStep:t[a].markStep,markRender:t[a].markRender,tooltipRender:t[a].tooltipRender,value:this.getChoice(t[a].attribute,n).value,disabled:t[a].disabled,callback:e=>{"function"==typeof t[a].onChange&&(e=t[a].onChange(e)),r({[t[a].attribute]:e})}}));return Object(c.createElement)(c.Fragment,null,a)}}class S extends h.a.Component{render(){let e=this.props.maxRadioOptions,t=this.props.value,r=this.props.label,n=this.props.help,a=this.props.choices,i=this.props.min,s=this.props.max,l=this.props.step,o=this.props.markStep,u=this.props.markRender,p=this.props.tooltipRender,d=this.props.multiple,h=this.props.invertValue||!1,g=this.props.disabled,m=this.props.callback;return Object(c.createElement)(c.Fragment,null,Array.isArray(t)?Object(c.createElement)(k,this.props):a?d?Object(c.createElement)(R,{label:r,help:n,options:a,value:t,callback:m,disabled:g}):a.length<=e?Object(c.createElement)(b.RadioControl,{label:r,help:n,selected:t,onChange:m,options:a,disabled:g}):Object(c.createElement)(b.SelectControl,{label:r,help:n,value:t,onChange:m,options:a,disabled:g}):isNaN(i)||isNaN(s)||isNaN(l)?Object(c.createElement)(b.ToggleControl,{label:r,help:n,checked:h!=Boolean(t),onChange:e=>m(h!=e),disabled:g}):Object(c.createElement)(N,{label:r,help:n,value:t,min:i,max:s,step:l,markStep:o,markRender:u,tooltipRender:p,disabled:g,callback:m}))}}class k extends h.a.Component{getProps(e,t){var r={...e};for(let[e,n]of Object.entries(r))Array.isArray(n)&&(r[e]=n[t]);return r}render(){let e=this.props.value,t=this.props.callback,r=[...Array(e.length).keys()].map(r=>Object(c.createElement)(S,_()({},this.getProps(this.props,r),{key:r,callback:n=>{let a=[...e];a[r]=n,t(a)}})));return Object(c.createElement)(c.Fragment,null,r)}}class R extends h.a.Component{constructor(e){super(e),this.id="ncs4-components-checkboxgroup-"+String(document.getElementsByClassName("ncs4-components-checkboxgroup").length)}render(){let e=this.props.label,t=this.props.help,r=this.props.value,n=this.props.options,a=this.props.disabled,i=this.props.callback,s=[...Array(n.length).keys()].map(e=>Object(c.createElement)(b.CheckboxControl,{key:e,label:n[e].label,checked:r.includes(n[e].value),disabled:a,name:this.id,onChange:t=>{var a=[...r];if(t)a.push(n[e].value);else{let t=a.indexOf(n[e].value);t>-1&&a.splice(t,1)}i(a)}}));return Object(c.createElement)("div",{className:"ncs4-components-checkboxgroup"},Object(c.createElement)("label",{className:"components-base-control__label css-pezhm9-StyledLabel e1puf3u2",for:this.id},e),Object(c.createElement)("p",{className:"components-base-control__help css-1gbp77-StyledHelp e1puf3u3"},t),s)}}class N extends h.a.Component{createMarks(e,t,r,n){var a=Array(Math.floor((t-e)/r)+1);for(let t=0;t<a.length;t++)a[t]={value:e,label:n(e)},e+=r;return a}render(){let e=this.props.label,t=this.props.help,r=this.props.value,n=this.props.min,a=this.props.max,i=this.props.step||1,s=this.props.markStep||i,l=this.props.markRender||(e=>String(e)),o=this.props.disabled,u=this.props.tooltipRender||l,p=this.props.callback;return Object(c.createElement)(b.RangeControl,{label:e,help:t,value:r,min:n,max:a,step:i,marks:this.createMarks(n,a,s,l),renderTooltipContent:u,disabled:o,onChange:p})}}h.a.Component;class A extends h.a.Component{validateNumber(e){return!Boolean(e)||A.reg.test(e)}render(){let e=this.validateNumber(this.props.value);return Object(c.createElement)(b.TextControl,{value:this.props.value,onChange:e=>{this.props.onChange(e)},label:"Phone",help:e?null:"Unrecognized phone number format (perhaps you've made a typo?)"})}}C()(A,"reg",/^(\+?[0-9]{1,4})?[ \-.]*[0-9]{3}[ \-.]*[0-9]{3}[ \-.]*[0-9]{4}$/);class z extends h.a.Component{validateEmail(e){return!Boolean(e)||z.reg.test(e)}render(){let e=this.validateEmail(this.props.value);return Object(c.createElement)(b.TextControl,{value:this.props.value,onChange:e=>{this.props.onChange(e),this.validateEmail(e)&&this.props.onChangeComplete(e)},label:"Email",help:e?null:"Invalid email address"})}}C()(z,"reg",/^(?:[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-zA-Z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/);const T=e=>e.ids||[],I=(e,t)=>{t=Number(t);let r=e.ids.length;if(t<0)return P(e);if(0===r)return-1;for(let n=0;n<r;n++)if(e.ids[n]===t)return P(e);return-1},P=e=>{for(let t=0;t<e.ids.length;t++){const r=e.ids[t];if(0===t&&0!==r)return r;if(t+1<e.ids.length&&e.ids[t+1]-1>r||t+1>=e.ids.length)return r+1}return 0};function D(e){return{type:"CREATE",id:e}}function Y(e){return{type:"DELETE",id:e}}class M extends h.a.Component{render(){let e=this.props.attributes,t="popup-"+String(e.id),r=e.bgColor.slug?null:e.bgColor.color,n=e.textColor.slug?null:e.textColor.color,a=`\n      #${t}:target {\n        display: block;\n      }\n    `;return Object(c.createElement)(c.Fragment,null,this.props.backend?Object(c.createElement)("a",{className:"ncs4-popup-button "+(this.props.className||"")+" "+(e.linkStyle||""),href:"#"},e.buttonTitle):Object(c.createElement)("a",{className:"ncs4-popup-button "+(this.props.className||"")+" "+(e.linkStyle||""),href:"#"+t},e.buttonTitle),Object(c.createElement)("div",{id:t,className:"ncs4-popup__wrapper",style:{textAlign:"left"}},Object(c.createElement)("a",{className:"ncs4-popup-overlay",href:"#!",style:{opacity:e.overlayOpacity}}),Object(c.createElement)("div",{className:"ncs4-popup-content__wrapper"},Object(c.createElement)("div",{className:["ncs4-popup-content",m(e.bgColor.slug,"background-color"),m(e.textColor.slug,"color"),e.optionSize].join(" "),style:{backgroundColor:r,"--palette-bg-color":r,color:n,"--palette-color":n}},this.props.children)),Object(c.createElement)("style",null,a)))}}C()(M,"classType","ncs4-custom-blocks_popup-type"),C()(M,"sizeOptions",[{value:"size-alert",label:"Alert"},{value:"size-small",label:"Small"},{value:"size-body",label:"Medium (body size)"},{value:"size-large",label:"Large"}]),C()(M,"linkOptions",[{value:"",label:"Link"},{value:"ncs4-button ncs4-button__blue",label:"Blue button"},{value:"ncs4-button ncs4-button__yellow",label:"Yellow button"},{value:"ncs4-button ncs4-button__gold",label:"Gold button"}]);class U extends h.a.Component{render(){let e=this.props.attributes,t=this.props.callback;return Object(c.createElement)(c.Fragment,null,Object(c.createElement)(b.PanelBody,{title:"Button settings",initialOpen:!0},Object(c.createElement)(b.TextControl,{label:"Button title",placeholder:"Show",value:e.buttonTitle,onChange:e=>{t({buttonTitle:e})}})),Object(c.createElement)(b.PanelBody,{title:"Popup area settings",initialOpen:!0},Object(c.createElement)(f,{label:"Popup background",value:e.bgColor.color,onChange:e=>{t({bgColor:e})}}),Object(c.createElement)(f,{label:"Popup text",value:e.textColor.color,onChange:e=>{t({textColor:e})}}),Object(c.createElement)(w,{options:[{attribute:"overlayOpacity",label:"Overlay opacity",value:Math.round(100*e.overlayOpacity),min:0,max:100,step:1,markStep:20,markRender:e=>String(e)+"%",onChange:e=>e/100},{attribute:"optionSize",label:"Content size",value:e.optionSize,choices:M.sizeOptions}],onChange:e=>{t(e)}})))}}var B,L,F,V,$;function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function W(e){return d.createElement("svg",G({id:"dismiss_svg__Layer_1","data-name":"Layer 1",xmlns:"http: //www.w3.org/2000/svg",viewBox:"0 0 43 95.17"},e),B||(B=d.createElement("defs",null,d.createElement("style",null,".dismiss_svg__cls-2,.dismiss_svg__cls-4{fill:none;stroke-width:3px;stroke-miterlimit:10}"))),L||(L=d.createElement("path",{className:"dismiss_svg__cls-1",d:"M21.5 42.5a21 21 0 1121-21 21 21 0 01-21 21",transform:"translate(0 52.67)"})),F||(F=d.createElement("path",{className:"dismiss_svg__cls-2",d:"M10.91 84.76l21.18-21.19M10.91 63.57l21.18 21.19"})),V||(V=d.createElement("path",{d:"M21.5-10.17a21 21 0 01-21-21 21 21 0 0121-21 21 21 0 0121 21 21 21 0 01-21 21m0-40a19 19 0 00-19 19 19 19 0 0019 19 19 19 0 0019-19 19 19 0 00-19-19z",transform:"translate(0 52.67)",strokeMiterlimit:10})),$||($=d.createElement("path",{className:"dismiss_svg__cls-4",d:"M10.91 32.09l21.18-21.18M10.91 10.91l21.18 21.18"})))}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){q(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}Object(g.registerStore)("ncs4/popup",{selectors:n,actions:a,reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ids:[]},{id:t,type:r}=arguments.length>1?arguments[1]:void 0;switch(t=Number(t),r){case"CREATE":let r=[],n=0,a=!1;for(let i=0;i<e.ids.length;i++)!a&&e.ids[i]>t&&(r[n]=t,a=!0,n++),r[n]=e.ids[i],n++;return a||(r[r.length]=t),{...e,ids:r};case"DELETE":return{...e,ids:e.ids.filter(e=>e!==t)};default:return e}}});var J="function"==typeof Symbol&&Symbol.observable||"@@observable",Q=function(){return Math.random().toString(36).substring(7).split("").join(".")},X={INIT:"@@redux/INIT"+Q(),REPLACE:"@@redux/REPLACE"+Q(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Q()}};function ee(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function te(e,t,r){var n;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error(H(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error(H(1));return r(te)(e,t)}if("function"!=typeof e)throw new Error(H(2));var a=e,i=t,s=[],l=s,o=!1;function c(){l===s&&(l=s.slice())}function u(){if(o)throw new Error(H(3));return i}function p(e){if("function"!=typeof e)throw new Error(H(4));if(o)throw new Error(H(5));var t=!0;return c(),l.push(e),function(){if(t){if(o)throw new Error(H(6));t=!1,c();var r=l.indexOf(e);l.splice(r,1),s=null}}}function d(e){if(!ee(e))throw new Error(H(7));if(void 0===e.type)throw new Error(H(8));if(o)throw new Error(H(9));try{o=!0,i=a(i,e)}finally{o=!1}for(var t=s=l,r=0;r<t.length;r++)(0,t[r])();return e}function h(e){if("function"!=typeof e)throw new Error(H(10));a=e,d({type:X.REPLACE})}function b(){var e,t=p;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(H(11));function r(){e.next&&e.next(u())}return r(),{unsubscribe:t(r)}}})[J]=function(){return this},e}return d({type:X.INIT}),(n={dispatch:d,subscribe:p,getState:u,replaceReducer:h})[J]=b,n}function re(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}var ne=r(8);const ae=(e,t)=>Array.isArray(t)?e.recipients.filter(e=>t.includes(e.id)):e.recipients,ie=e=>e,se=e=>e.ids,le=e=>e.useOrgs,oe=e=>e.currentYear,ce=e=>e.organizations,ue=(e,t)=>e.ids.includes(t),pe=(e,t)=>({...t,id:isNaN(t.id)||ue(t.id)?de(e):t.id}),de=e=>{for(let t=0;t<e.ids.length;t++){const r=e.ids[t];if(0===t&&0!==r)return r;if(t+1<e.ids.length&&e.ids[t+1]-1>r||t+1>=e.ids.length)return r+1}return 0},he="EDIT";function be(e){return{type:"CREATE",data:e}}function ge(e){return{type:"DELETE",data:e}}function me(e,t){return{type:he,oldData:e,data:t}}function fe(e){return{type:"SET_RECIPIENTS",data:e}}function Oe(e){return{type:"SET_ORGS",useOrgs:e}}function ye(e){return{type:"SET_CURRENT_YEAR",year:e}}function Ee(e){return{type:"SET_CURRENT_YEAR_IF",year:e}}function ve(){return{type:"RECALCULATE_CURRENT_YEAR"}}function je(e){return{type:"ADD_ORG",organization:e}}function Ce(){return{type:"SORT"}}function xe(e){return{type:"SET_CURRENT_YEAR_IF",year:e}}function _e(e,t,r){let n=[],a=0,i=0,s=!1;for(;i<e.length;)s||r(e[i],t)<0?(n[a]=e[i],i++):(s=!0,n[a]=t),a++;return s||(n[n.length]=t),n}function we(e,t){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(e,r)=>{let n;for(let a=0;a<t.length;a++)if(n=t[a](e,r),0!==n)return n;return n}}(Se,Re,Ne)(e,t)}function Se(e,t){return!e.editMode||null!=e.name||t.editMode&&null==t.name?e.editMode&&null==e.name||!t.editMode||null!=t.name?0:1:-1}function ke(e,t){return e===t?0:2*Number(e.toUpperCase()>t.toUpperCase())-1}function Re(e,t){return e.year===t.year?0:t.year-e.year}function Ne(e,t){if(!e.name||!t.name||""===e.name||""===t.name||e.name===t.name)return 0;let r=Ae(e.name),n=Ae(t.name);return 2*Number(r.toUpperCase()>n.toUpperCase())-1}function Ae(e){let t=e.search(/[\S]+$/),r=e.slice(t),n="";return t>0&&(n=e.slice(0,t-1)),r+", "+n}const ze={pro:{title:"Professional Sports and Entertainment",useOrgs:!0},college:{title:"Intercollegiate Athletics",useOrgs:!1},hs:{title:"Interscholastic Athletics and After-School Activities",useOrgs:!1},marathon:{title:"Marathon and Endurance Events",useOrgs:!1},other:{title:"Other",useOrgs:!0}},Te=["industry","organization"];function Ie(e,t){if(Array.isArray(e))e.forEach(t);else for(let r in e)"order"!==r&&"length"!==r&&Ie(e[r],t)}function Pe(e,t,r,n){let a={current:e.current||[],previous:e.previous||(r?{}:[])};const i=we;return t.year===n?a.current=_e(a.current,t,i):r?(a.previous=function e(t,r,n,a){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(r.length>0){let s=n[r[0]];if("organization"!==r[0]||s||(s="Unaffiliated"),"organization"===r[0]&&!i)return e(t,r.slice(1),n,a,i);if(r.length&&!t[s]){let e=t.order||[];e=_e(e,s,ke),t.order=e,t[s]={}}else t[s]=t[s]||[];return"industry"===r[0]&&ze[s]?t[s]=e(t[s],r.slice(1),n,a,ze[s].useOrgs):t[s]=e(t[s],r.slice(1),n,a),t}return _e(t,n,a)}(a.previous,Te,t,i,r=t.organization&&ze[t.organization]?ze[t.organization].useOrgs:r),a.previous.length=a.previous.length?a.previous.length+1:1):a.previous=_e(a.previous,t,i),a}function De(e,t,r){const n=["industry","organization"];let a=[];if(t.year===r)a.push("current");else{a.push("previous");let r="previous",i=[...n];for(;!Array.isArray(e[r]);)e=e[r],r=t[i[0]],i=i.slice(1),a.push(r)}return a}function Ye(e,t,r){let n=t;for(let t=r.length-1;t>=0;t--)n={...Me(e,r.slice(0,t)),[r[t]]:n};return{...e,...n}}function Me(e,t){for(let r=0;r<t.length;r++)e=e[t[r]];return e}var Ue,Be=(Ue={recipients:{reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,{useOrgs:r,currentYear:n}=arguments.length>2?arguments[2]:void 0;switch(t.type){case"CREATE":return t.asyncDispatch(Ee(t.data.year)),Pe(e,t.data,r,n);case"DELETE":{let r=De(e,t.data,n),a=Me(e,r).filter(e=>e.id!==t.data.id);if(t.data.year===n&&e.current.length<2){let r=null;Ie(e.previous,e=>{(!r||e.year>r)&&(r=e.year)}),t.asyncDispatch(ye(r))}return Ye(e,a,r)}case he:return t.asyncDispatch(ge(t.oldData)),t.asyncDispatch(be(t.data)),e;case"SET_RECIPIENTS":return t.asyncDispatch({type:"RECALCULATE_CURRENT_YEAR"}),Object.assign({},t.data);case"SORT":{let t={};return Ie(e,e=>{t=Pe(t,e,r,n)}),t}default:return e}},stateReducer:e=>({useOrgs:e.useOrgs,currentYear:e.currentYear})},ids:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE":{let r=[],n=0,a=!1,i=t.data;for(let t=0;t<e.length;t++)!a&&e[t]>i.id&&(r[n]=i.id,a=!0,n++),r[n]=e[t],n++;return a||(r[r.length]=i.id),r}case"DELETE":return e.filter(e=>e!==t.id);case he:return e.includes(t.data.id)||console.error(he+": id '"+t.data.id+"' not found"),e;default:return e}},useOrgs:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ORGS":return t.useOrgs;default:return e}},organizations:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_ORG":return e.includes(t.organization)?e:[...e,t.organization];default:return e}},currentYear:{reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,{recipients:r}=arguments.length>2?arguments[2]:void 0;switch(t.type){case"SET_CURRENT_YEAR_IF":return!e||e<t.year?(t.asyncDispatch({type:"SORT"}),t.year):e;case"SET_CURRENT_YEAR":return t.asyncDispatch({type:"SORT"}),t.year;case"RECALCULATE_CURRENT_YEAR":{let e=null;return Ie(r,t=>{(!e||t.year>e)&&(e=t.year)}),t.asyncDispatch({type:"SORT"}),e}default:return e}},stateReducer:e=>({recipients:e.recipients})}},function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r={};for(let n in Ue)if("function"==typeof Ue[n])r[n]=Ue[n](e[n],t);else{let{reducer:a,stateReducer:i}=Ue[n];i=i||(e=>null),r[n]=a(e[n],t,i(e))}return r});const Le="ncs4/recipient-store",Fe={name:Le,instantiate:()=>{new Set;const e=te(Be,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error(H(15))},a={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map((function(e){return e(a)}));return n=re.apply(void 0,i)(r.dispatch),K(K({},r),{},{dispatch:n})}}}(e=>e=>t=>e(t),e=>t=>r=>{let n=!1,a=[];function i(){a.forEach(t=>e.dispatch(t)),a=[]}const s=Object.assign({},r,{asyncDispatch:function(e){a=a.concat([e]),n&&i()}});t(s),n=!0,i()})),t=Object(ne.mapValues)(s,t=>function(){return e.dispatch(t(...arguments))}),r=Object(ne.mapValues)(i,t=>function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return t(e.getState(),...n)});return{actions:s,selectors:i,subscribe:t=>e.subscribe(t),reducer:Be,getSelectors:()=>r,getActions:()=>t,store:e}}},Ve={pro:{title:"Professional Sports and Entertainment",useOrgs:!0},college:{title:"Intercollegiate Athletics",useOrgs:!1},hs:{title:"Interscholastic Athletics and After-School Activities",useOrgs:!1},marathon:{title:"Marathon and Endurance Events",useOrgs:!1},other:{title:"Other",useOrgs:!0}};function $e(e){return"string"==typeof e.name&&""!==e.name&&!(!e.year||isNaN(e.year)||e.year<2e3)}const Ge=h.a.createContext({backend:!1,onChange:null,recipients:[],useOrgs:!1,actions:null,currentYear:null});function We(e){const t=Object(g.useDispatch)(Le),r=Object(g.useSelect)(e=>e(Le).getRecipients()),n=Object(g.useSelect)(e=>e(Le).getCurrentYear()),a=Object(g.useSelect)(e=>e(Le).getUseOrgs());return r&&r.current?Object(c.createElement)(Ge.Provider,{value:{backend:!0,onChange:t.editRecipient,recipients:r,useOrgs:a,actions:t,currentYear:n}},Object(c.createElement)(Ge.Consumer,null,e=>Object(c.createElement)(Ze,{recipients:e.recipients,currentYear:e.currentYear,depth:0}))):null}function qe(e){let t=e.recipients;return t&&t.current&&t.previous&&t.current[0]?(t.previous.length,Object(c.createElement)(Ge.Provider,{value:{backend:!1,recipients:t,useOrgs:e.useOrgs,currentYear:t.current[0].year}},Object(c.createElement)(Ge.Consumer,null,e=>Object(c.createElement)(Ze,{recipients:e.recipients,currentYear:e.currentYear,depth:0})))):null}function Ze(e){let t=[],r=e.recipients,n=r.order||Object.keys(r).filter(e=>"order"!==e&&"length"!==e);for(let r of n){let n,a=e.recipients[r];Ve[r]?n=Ve[r].title:"current"===r?(n=a.length>0?a[0].year+" Recipient":null,n=a.length>1?n+"s":n):"previous"===r?(n=a.length>0?"Previous Recipient":null,n=a.length>1?n+"s":n):n=r,t.push(Object(c.createElement)(Ke,{key:r,recipients:a,header:n,displayYear:"current"!==r,depth:e.depth}))}return Object(c.createElement)(c.Fragment,null,t)}function Ke(e){let t=Array.isArray(e.recipients)?Object(c.createElement)(Je,{recipients:e.recipients,displayYear:e.displayYear,depth:e.depth}):Object(c.createElement)(Ze,{recipients:e.recipients,displayYear:e.displayYear,depth:e.depth+1});return Object(c.createElement)(c.Fragment,null,e.header&&Object(c.createElement)(He,{depth:e.depth,header:e.header}),t)}function He(e){let t={className:"ncs4-award-recipient__header",depth:e.depth};return Object(c.createElement)(c.Fragment,null,0===e.depth&&Object(c.createElement)("p",t,e.header),1===e.depth&&Object(c.createElement)("p",t,e.header),2===e.depth&&Object(c.createElement)("p",t,e.header),e.depth>2&&Object(c.createElement)("p",t,e.header))}function Je(e){return Object(c.createElement)(c.Fragment,null,e.recipients.map(t=>Object(c.createElement)(Ge.Consumer,null,r=>Object(c.createElement)(c.Fragment,null,r.backend?Object(c.createElement)(Qe,o()({},r,{recipient:t,key:t.id,displayYear:e.displayYear})):Object(c.createElement)(Xe,o()({},r,{recipient:t,key:t.id,displayYear:e.displayYear}))))))}function Qe(e){let t=e.recipient,[r,n]=Object(d.useState)(Boolean(t.editMode)),a=e.actions,i=Object(g.useSelect)(e=>e(Le).getOrganizations()),{addOrganization:s}=e.actions;return Object(c.createElement)(c.Fragment,null,r?Object(c.createElement)(et,o()({},e,{initialState:t,delete:()=>a.deleteRecipient(t),cancel:()=>n(!1),save:r=>{n(!1),r.organization&&!i.includes(r.organization)&&a.addOrganization(r.organization),e.onChange(t,{...r,editMode:!1})}})):Object(c.createElement)(Xe,o()({},e,{recipient:t,setEditing:n})))}function Xe(e){let t=e.recipient;return Object(c.createElement)("p",{className:"ncs4-award-recipient"},Object(c.createElement)("span",{className:"ncs4-award-recipient__name"},t.name),t.position&&Object(c.createElement)(c.Fragment,null,", ",Object(c.createElement)("span",{className:"ncs4-award-recipient__position"},t.position)),e.displayYear&&Object(c.createElement)(c.Fragment,null,", ",Object(c.createElement)("span",{className:"ncs4-award-recipient__year"},t.year)),e.useOrgs&&t.organization&&!e.displayYear&&Object(c.createElement)(c.Fragment,null," (",t.organization,")"),e.backend&&Object(c.createElement)("span",{className:"dashicons dashicons-edit ncs4-award-recipient__edit",onClick:()=>e.setEditing(!0)}))}function et(e){let[t,r]=Object(d.useState)(e.initialState),[n,a]=Object(d.useState)({deleteClicked:!1,cancelClicked:!1,saveValid:!0}),i=e=>n=>{r({...t,[e]:n})},s=e=>t=>{a({...n,[e]:t})},l=Object(g.useSelect)(e=>e(Le).getOrganizations());const o="dashicons dashicons-trash ncs4-award-recipient__edit-delete";return Object(c.createElement)("div",{className:"ncs4-award-card__recipient-editer"},Object(c.createElement)("span",{className:n.deleteClicked?o+" toggled":o,tabIndex:0,onClick:t=>{n.deleteClicked?e.delete():s("deleteClicked")(!0)},onBlur:()=>s("deleteClicked")(!1)}),Object(c.createElement)("span",{className:["dashicons dashicons-no ncs4-award-recipient__edit-cancel",n.cancelClicked?"toggled":null,e.cancelDisabled?"disabled":null].join(" "),tabIndex:0,onClick:e.cancelDisabled?null:t=>{n.cancelClicked?e.cancel():s("cancelClicked")(!0)},onBlur:()=>s("cancelClicked")(!1)}),Object(c.createElement)("span",{className:"dashicons dashicons-yes ncs4-award-recipient__edit-save",onClick:()=>{$e(t)?(s("saveValid")(!0),e.save(t)):s("saveValid")(!1)}}),Object(c.createElement)("div",{className:"ncs4-award-recipient__input-fields-area"},Object(c.createElement)(b.TextControl,{value:t.name,label:"Recipient name",placeholder:"John Deer",onChange:i("name")}),Object(c.createElement)(b.TextControl,{value:t.position,label:"Recipient position",placeholder:"Super-executive-vice-president of business operations",onChange:i("position")}),Object(c.createElement)("div",{className:"ncs4-award-recipient__field-row"},Object(c.createElement)("div",{className:"ncs4-award-recipient__organization-container"},Object(c.createElement)("label",{className:"ncs4-award-recipient__organization-label css-1wzzj1a css-4dk55l e1puf3u1",for:"organization_award-"+e.awardId+"_recipient-"+e.id},"Organization"),Object(c.createElement)("input",{type:"text",className:"css-1kyqli5",list:"organizations_award-"+e.awardId+"_recipient-"+e.id,id:"organization_award-"+e.awardId+"_recipient-"+e.id,value:t.organization,placeholder:"NCS⁴",onChange:e=>{i("organization")(e.target.value)}}),Object(c.createElement)("datalist",{id:"organizations_award-"+e.awardId+"_recipient-"+e.id},l.map(e=>Object(c.createElement)("option",{value:e,key:e})))),Object(c.createElement)("div",{className:"ncs4-award-recipient__year-container"},Object(c.createElement)("label",{className:"ncs4-award-recipient__year-label css-1wzzj1a css-4dk55l e1puf3u1",for:"award-year_award-"+e.awardId+"_recipient-"+e.id},"Award Year"),Object(c.createElement)("input",{type:"number",id:"award-year_award-"+e.awardId+"_recipient-"+e.id,className:"css-1kyqli5",value:t.year,onChange:e=>i("year")(e.target.value)})),Object(c.createElement)(b.RadioControl,{label:"Industry segment",selected:t.industry,options:[{label:"Professional & Entertainment",value:"pro"},{label:"Intercollegiate",value:"college"},{label:"Interscholastic & After-School",value:"hs"},{label:"Marathon & Endurance",value:"marathon"},{label:"Miscellaneous",value:"other"}],onChange:i("industry")}))))}class tt extends h.a.Component{render(){let e=this.props.blockProps,t=this.props.attributes;return Object(c.createElement)("div",o()({},e,{className:["ncs4-award-card",M.classType,e.className].join(" ")}),Object(c.createElement)("h2",{className:"ncs4-award-card__name"},t.name),Object(c.createElement)(p.RichText.Content,{className:"ncs4-award-card__description",tagName:"p",value:t.normalizedDesc}),Object(c.createElement)(M,{attributes:t,backend:this.props.backend},Object(c.createElement)("div",{className:"ncs4-award-card__popup-header"},Object(c.createElement)("h1",{className:"ncs4-award-card__popup-name"},t.name),Object(c.createElement)("a",{href:"#!",className:"ncs4-award-card__popup-dismiss-link",title:"Dismiss"},Object(c.createElement)(W,{className:"ncs4-award-card__popup-dismiss",viewBox:"0 52.67 43 43"}))),Object(c.createElement)("div",{className:"ncs4-award-card__popup-content"},Object(c.createElement)(p.RichText.Content,{className:"ncs4-award-card__popup-description",tagName:"p",value:t.desc}),Object(c.createElement)(qe,t))))}}class rt extends h.a.Component{constructor(e){super(e),this.attributes=e.attributes,this.setAttributes=e.setAttributes,this.registry=Object(g.createRegistry)({}),this.registry.register(Fe),this.setStateAttributes=this.setStateAttributes.bind(this),this.trimStateAttribute=this.trimStateAttribute.bind(this),this.onStoreUpdate=this.onStoreUpdate.bind(this),this.handleDescription=this.handleDescription.bind(this),!this.attributes.desc||this.attributes.normalizedDesc&&400===this.attributes.normalizedDesc.length||this.handleDescription(this.attributes.desc),function(e,t,r){let n=e.dispatch(Le),a=e.select(Le).getOrganizations();n.setUseOrgs(r),Ie(t,t=>{n.updateCurrentYear(t.year),n.createRecipient({...t,id:e.select(Le).getNextId(),industry:t.industry||"other"}),t.organization&&!a.includes(t.organization)&&n.addOrganization(t.organization)})}(this.registry,this.attributes.recipients,this.attributes.useOrgs),this.registry.stores[Le].subscribe(this.onStoreUpdate),this.state={overlayOpacity:this.attributes.overlayOpacity,bgColor:this.attributes.bgColor,textColor:this.attributes.textColor,id:this.attributes.id,customId:this.attributes.customId,optionSize:this.attributes.optionSize,buttonTitle:this.attributes.buttonTitle,name:this.attributes.name,desc:this.attributes.desc}}componentDidMount(){!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=Object(g.select)("ncs4/popup"),{createId:n,deleteId:a}=Object(g.dispatch)("ncs4/popup"),i=r.requestId(t);-1!==i?(e(i),n(i)):(e(t),n(t))}(e=>this.setStateAttributes({id:e}),this.state.id),this.setStateAttributes({bgColor:{color:O(this.state.bgColor),slug:this.state.bgColor.slug}}),this.setStateAttributes({textColor:{color:O(this.state.textColor),slug:this.state.textColor.slug}})}componentWillUnmount(){!function(e){let{deleteId:t}=Object(g.dispatch)("ncs4/popup");t(e)}(this.state.id)}setStateAttributes(e){this.setState(e,()=>{this.setAttributes(e)})}trimStateAttribute(e){return t=>{this.setState({[e]:t},()=>{this.setAttributes({[e]:t.trim()})})}}onStoreUpdate(){this.setAttributes(function(e){let t=e.select(Le).getRecipients();e.select(Le).getCurrentYear();let r=["editMode","cancelDisabled"];return{recipients:function e(t,r){let n={};if(Array.isArray(t))return t.reduce(r,[]);for(let a in t)n[a]="order"!==a&&"length"!==a?e(t[a],r):t[a];return n}(t,(e,t)=>{if($e(t)){let n={};for(let e in t)r.includes(e)||(n[e]="string"==typeof t[e]?t[e].trim():t[e]);return e.concat([n])}return e})}}(this.registry))}handleDescription(e){e=e.trim(),this.setStateAttributes({desc:e}),this.setAttributes({normalizedDesc:y(e,400)})}render(){let e=this.props.blockProps,t=this.registry;return Object(c.createElement)(c.Fragment,null,Object(c.createElement)("div",o()({},e,{className:["ncs4-award-card",M.classType,e.className].join(" ")}),Object(c.createElement)("h2",{className:"ncs4-award-card__name"},this.state.name),Object(c.createElement)(p.RichText,{className:"ncs4-award-card__description",tagName:"p",value:this.state.desc,onChange:this.handleDescription,placeholder:"Award description..."}),Object(c.createElement)("div",{className:"ncs4-award-card__edit-recipients"},Object(c.createElement)("p",null,"Recipients"),Object(c.createElement)("span",{className:"dashicons dashicons-plus",title:"Add recipient",onClick:()=>function(e){let{createRecipient:t}=e.dispatch(Le);t({year:(new Date).getFullYear(),id:e.select(Le).getNextId(),industry:"other",editMode:!0,cancelDisabled:!0})}(t)})),Object(c.createElement)(g.RegistryProvider,{value:t},Object(c.createElement)(We,{awardId:e.id}))),Object(c.createElement)(p.InspectorControls,null,Object(c.createElement)(b.PanelBody,{title:"Award info",initialOpen:!0},Object(c.createElement)(b.TextControl,{value:this.state.name,label:"Award name",help:"Name of the award",placeholder:"World's Best Web Dev",onChange:this.trimStateAttribute("name")}),Object(c.createElement)(b.CheckboxControl,{label:"Split past recipients by organization",help:"Leave checked to organize past recipients by their organization",checked:this.registry.select(Le).getUseOrgs(),onChange:e=>{let{setUseOrgs:t,sortRecipients:r}=this.registry.dispatch(Le);t(e),r(),this.setAttributes({useOrgs:e})}})),Object(c.createElement)(U,{attributes:this.state,callback:this.setStateAttributes})))}}Object(u.registerBlockType)("ncs4-custom-blocks/award-card",{apiVersion:2,title:"Award Card",icon:"awards",category:"layout",attributes:{overlayOpacity:{type:"number",default:.9},bgColor:{type:"object",default:{color:null,slug:"white-bright"}},textColor:{type:"object",default:{color:null,slug:"secondary-1c"}},id:{type:"number"},customId:{type:"string"},optionSize:{type:"string",default:"size-body"},buttonTitle:{type:"string",default:"Read More"},name:{type:"string",default:"Award"},desc:{type:"string"},normalizedDesc:{type:"string"},recipients:{type:"object",default:{}},displayPrevious:{type:"boolean",default:!1},useOrgs:{type:"boolean",default:!1}},edit:e=>Object(c.createElement)(rt,o()({},e,{blockProps:Object(p.useBlockProps)()})),save:e=>Object(c.createElement)(tt,o()({},e,{blockProps:p.useBlockProps.save()}))})}]);