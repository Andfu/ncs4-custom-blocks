!function(t){var e={};function o(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(s,r,function(e){return t[e]}.bind(null,r));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=7)}([function(t,e){t.exports=window.wp.element},function(t,e){t.exports=window.wp.blockEditor},function(t,e){t.exports=window.wp.components},function(t,e){function o(){return t.exports=o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])}return t},t.exports.default=t.exports,t.exports.__esModule=!0,o.apply(this,arguments)}t.exports=o,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=window.wp.data},function(t,e){t.exports=window.React},function(t,e){t.exports=window.wp.blocks},function(t,e,o){"use strict";o.r(e);var s=o(3),r=o.n(s),l=o(0),n=o(6),i=o(4),a=o(1),c=o(5),u=o.n(c),p=o(2);function b(t,e=!1){return"has-"+t+(e?"-background-color":"-color")}let d=[["size-alert","Alert"],["size-small","Small"],["size-body","Medium (body size)",!0],["size-large","Large"]];[d].forEach(t=>{t.values=()=>t.map(t=>t[0]),t.labels=()=>t.map(t=>t[1]),t.default=()=>t.filter(t=>t[2])[0][0],t.toOptions=()=>t.map(t=>({value:t[0],label:t[1]}))});class h extends u.a.Component{constructor(t){super(t),this.attributes=t.attributes,this.blockProps=t.blockProps,this.clientId=t.clientId,this.setAttributes=t.setAttributes,this.setStateAttributes=this.setStateAttributes.bind(this),this.handleSelected=this.handleSelected.bind(this),this.onButtonTitleChange=this.onButtonTitleChange.bind(this),this.onBgColorChange=this.onBgColorChange.bind(this),this.onTextColorChange=this.onTextColorChange.bind(this),this.state={showModal:!1,overlayOpacity:this.attributes.overlayOpacity,bgColor:this.attributes.bgColor,textColor:this.attributes.textColor,buttonTitle:this.attributes.buttonTitle,id:this.attributes.id,optionSize:this.attributes.optionSize},this.state.optionSize||this.setStateAttributes({optionSize:d.default()}),wp.data.subscribe(this.handleSelected)}componentDidMount(){let t=this.getUsedIds();this.state.id&&this.isIdAvailable(this.state.id,t)||this.setStateAttributes({id:String(this.getNextId(t))})}createClassName(t){return["ncs4-popup",this.state.showModal?"is-selected":null].join(" ")+" "+t}setStateAttributes(t){this.setState(t,()=>{this.setAttributes(t)})}getSettings(){return Object(i.select)("core/block-editor").getSettings()}handleSelected(){let t=Object(i.select)("core/block-editor").getSelectedBlock();t&&(this.state.showModal||t.clientId!==this.clientId?this.state.showModal&&t.clientId!==this.clientId&&this.setState({showModal:!1}):this.setState({showModal:!0}))}getColor(t){return this.getSettings().colors.filter(e=>e.color===t)[0]}getUsedIds(){let t=document.querySelectorAll('[data-type="ncs4-custom-blocks/popup"]'),e=[];return t.forEach(t=>{let o=Object(i.select)("core/block-editor").getBlock(t.getAttribute("data-block")).attributes.id;e.push(/^\d+$/.test(o)?parseInt(o):o)}),e.sort()}isIdAvailable(t,e){for(let o of e){if(o===t)return!1;if(t<o)return!0}return!0}getNextId(t){let e="number"==typeof t[0]?t[0]:-1;for(let o=1;o<t.length&&!("number"!=typeof t[o]||t[o]-e-1);o++)e=t[o];return e+1}onButtonTitleChange(t){this.setStateAttributes({buttonTitle:t})}setColorStateAttribute(t,e,o){this.setStateAttributes({[t]:{color:e,slug:o?o.slug:null}})}onBgColorChange(t){let e=this.getColor(t);this.setColorStateAttribute("bgColor",t,e)}onTextColorChange(t){let e=this.getColor(t);this.setColorStateAttribute("textColor",t,e)}render(){const t=this.getSettings();return Object(l.createElement)("div",r()({},this.blockProps,{className:this.createClassName(this.blockProps.className)}),Object(l.createElement)(g,{attributes:this.state}),Object(l.createElement)(a.InspectorControls,null,Object(l.createElement)(p.PanelBody,{title:"Button settings",initialOpen:!0},Object(l.createElement)(p.TextControl,{label:"Button title",placeholder:"Show",value:this.state.buttonTitle,onChange:this.onButtonTitleChange})),Object(l.createElement)(p.PanelBody,{title:"Popup area settings",initialOpen:!0},Object(l.createElement)("p",null,"Popup background"),Object(l.createElement)(p.ColorPalette,{colors:t.colors,disableCustomColors:t.disableCustomColors,clearable:!1,value:this.state.bgColor.color,onChange:this.onBgColorChange}),Object(l.createElement)("p",null,"Popup text"),Object(l.createElement)(p.ColorPalette,{colors:t.colors,disableCustomColors:t.disableCustomColors,clearable:!1,value:this.state.textColor.color,onChange:this.onTextColorChange}),Object(l.createElement)(p.RangeControl,{label:"Overlay opacity",value:Math.round(100*this.state.overlayOpacity),min:0,max:100,step:1,marks:[...Array(6).keys()].map(t=>({value:20*t,label:String(20*t)+"%"})),renderTooltipContent:t=>String(t)+"%",onChange:t=>{this.setStateAttributes({overlayOpacity:t/100})}}),Object(l.createElement)(p.RadioControl,{label:"Content size",selected:this.state.optionSize,onChange:t=>{this.setStateAttributes({optionSize:t})},options:d.toOptions()}))))}}class g extends u.a.Component{constructor(t){super(t)}render(){const t=this.props.attributes;return Object(l.createElement)(l.Fragment,null,Object(l.createElement)("a",{className:"ncs4-popup-button"},t.buttonTitle),Object(l.createElement)("a",{className:"ncs4-popup-overlay"+(t.showModal?" shown":"")}),Object(l.createElement)("div",{className:"ncs4-popup-content__wrapper"},Object(l.createElement)("div",{className:["ncs4-popup-content",b(t.bgColor.slug,!0),b(t.textColor.slug,!1),t.optionSize].join(" ")},Object(l.createElement)(a.InnerBlocks,null))))}}function m(t,e=!1){return"has-"+t+(e?"-background-color":"-color")}class C extends u.a.Component{constructor(t){super(t),this.blockProps=t.blockProps,this.visible=t.visible||t.attributes.showOnLoad||!1}createClassName(t){return["ncs4-popup"].join(" ")+" "+t}render(){const t=this.props.attributes;let e="popup-"+t.id,o=`\n      #${e}:target {\n        display: block;\n      }\n    `;return Object(l.createElement)("div",r()({},this.blockProps,{className:this.createClassName(this.blockProps.className)}),Object(l.createElement)("a",{className:"ncs4-popup-button",href:"#"+e},t.buttonTitle),Object(l.createElement)("div",{id:e,className:"ncs4-popup__wrapper"},Object(l.createElement)("a",{className:"ncs4-popup-overlay",href:"#!",style:{opacity:t.overlayOpacity}}),Object(l.createElement)("div",{className:"ncs4-popup-content__wrapper"},Object(l.createElement)("div",{className:["ncs4-popup-content",m(t.bgColor.slug,!0),m(t.textColor.slug,!1),t.optionSize].join(" ")},Object(l.createElement)(a.InnerBlocks.Content,null))),Object(l.createElement)("style",null,o)))}}let f=Object(i.select)("core/block-editor").getSettings().colors;const y=t=>{let e=f.filter(e=>e.slug===t)[0];return e?e.color:null};Object(n.registerBlockType)("ncs4-custom-blocks/popup",{apiVersion:2,title:"Popup",icon:"testimonial",category:"layout",attributes:{overlayOpacity:{type:"number",default:.9},bgColor:{type:"object",default:{color:y("white-bright"),slug:"white-bright"}},textColor:{type:"object",default:{color:y("secondary-1c"),slug:"secondary-1c"}},buttonTitle:{type:"string"},id:{type:"string"},optionSize:{type:"string"}},edit:t=>Object(l.createElement)(h,r()({},t,{blockProps:Object(a.useBlockProps)()})),save:t=>Object(l.createElement)(C,r()({},t,{blockProps:a.useBlockProps.save()}))})}]);